<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è´¢ç»æ™ºèƒ½åˆ†æç³»ç»Ÿ - æ§åˆ¶é¢æ¿</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>è´¢ç»æ™ºèƒ½åˆ†æç³»ç»Ÿ</h1>
            <p>å®æ—¶ç›‘æ§è´¢ç»åŠ¨æ€ï¼Œæ™ºèƒ½åˆ†ææŠ•èµ„æœºä¼š</p>
            <div style="margin-top: 15px;">
                <span class="status-indicator status-running pulsing"></span>
                <span id="systemStatus">ç³»ç»Ÿè¿è¡Œä¸­</span>
                <span style="margin-left: 20px; color: #666;">ä¸Šæ¬¡æ›´æ–°: <span id="lastUpdate">{{ last_update }}</span></span>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- ç³»ç»Ÿæ¦‚è§ˆ -->
            <div class="card">
                <div class="card-title">ğŸ“Š ç³»ç»Ÿæ¦‚è§ˆ</div>
                <div class="metric-row">
                    <span class="metric-label">ä»Šæ—¥åˆ†æè§†é¢‘</span>
                    <span class="metric-value" id="todayVideos">{{ stats.today_videos or 0 }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ä»Šæ—¥åˆ†æåŠ¨æ€</span>
                    <span class="metric-value" id="todayDynamics">{{ stats.today_dynamics or 0 }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ä»Šæ—¥æ–°é—»æ•°é‡</span>
                    <span class="metric-value" id="todayNews">{{ stats.today_news or 0 }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">æ€»åˆ†ææ¬¡æ•°</span>
                    <span class="metric-value" id="totalAnalysis">{{ stats.total_analysis or 0 }}</span>
                </div>
            </div>

            <!-- æƒ…æ„Ÿåˆ†æ -->
            <div class="card">
                <div class="card-title">ğŸ˜Š æƒ…æ„Ÿåˆ†æ</div>
                <div class="metric-row">
                    <span class="metric-label">æ•´ä½“æƒ…æ„Ÿ</span>
                    <span class="metric-value positive" id="overallSentiment">{{ sentiment.overall or 'ä¸­æ€§' }}</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ç§¯æå†…å®¹</span>
                    <span class="metric-value positive" id="positiveSentiment">{{ sentiment.positive or 0 }}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">æ¶ˆæå†…å®¹</span>
                    <span class="metric-value negative" id="negativeSentiment">{{ sentiment.negative or 0 }}%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">ä¸­æ€§å†…å®¹</span>
                    <span class="metric-value neutral" id="neutralSentiment">{{ sentiment.neutral or 0 }}%</span>
                </div>
            </div>

            <!-- æŠ•èµ„ä¿¡å· -->
            <div class="card">
                <div class="card-title">ğŸ“ˆ æœ€æ–°æŠ•èµ„ä¿¡å·</div>
                <div class="signal-list" id="signalList">
                    {% for signal in signals %}
                    <div class="signal-item {{ signal.type }}">
                        <div class="signal-target">{{ signal.target }}</div>
                        <div class="signal-context">{{ signal.context }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- è¶‹åŠ¿å›¾è¡¨ -->
            <div class="card">
                <div class="card-title">ğŸ“Š åˆ†æè¶‹åŠ¿</div>
                <div class="chart-container">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>

            <!-- çƒ­é—¨è¯é¢˜ -->
            <div class="card">
                <div class="card-title">ğŸ”¥ çƒ­é—¨è¯é¢˜</div>
                <div id="hotTopics">
                    {% for topic in hot_topics %}
                    <div class="metric-row">
                        <span class="metric-label">{{ topic.keyword }}</span>
                        <span class="metric-value">{{ topic.count }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- æœ€æ–°æ–°é—» -->
            <div class="card">
                <div class="card-title">ğŸ“° æœ€æ–°è´¢ç»æ–°é—»</div>
                <div id="newsList">
                    {% for news in latest_news %}
                    <div class="news-item">
                        <div class="news-title">{{ news.title }}</div>
                        <div class="news-meta">
                            <span>{{ news.source }}</span>
                            <span>{{ news.publish_time }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- æ§åˆ¶é¢æ¿ -->
        <div class="controls">
            <h3 style="margin-bottom: 20px;">ç³»ç»Ÿæ§åˆ¶</h3>
            <button class="btn" onclick="startAnalysis()">å¼€å§‹åˆ†æ</button>
            <button class="btn" onclick="stopAnalysis()">åœæ­¢åˆ†æ</button>
            <button class="btn" onclick="generateReport()">ç”ŸæˆæŠ¥å‘Š</button>
            <button class="btn" onclick="refreshData()">åˆ·æ–°æ•°æ®</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script>
        // åˆå§‹åŒ–å›¾è¡¨æ•°æ®
        const chartLabels = {{ chart_labels | tojsonfilter | safe }};
        const chartData = {{ chart_data | tojsonfilter | safe }};
        
        // åˆå§‹åŒ–å›¾è¡¨
        const ctx = document.getElementById('trendChart').getContext('2d');
        const trendChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: chartLabels,
                datasets: [{
                    label: 'æƒ…æ„Ÿåˆ†æ•°',
                    data: chartData,
                    borderColor: 'rgb(102, 126, 234)',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        min: -1,
                        max: 1
                    }
                }
            }
        });

        // å®šæ—¶åˆ·æ–°æ•°æ®
        setInterval(refreshData, 60000); // æ¯åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡
    </script>
</body>
</html> 